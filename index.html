<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Medical News — Webview</title>
<style>
  :root { --bg:#0b0f14; --card:#121821; --ink:#ecf2f8; --muted:#9fb1c1; --accent:#5aa9e6; --chip:#223044; }
  * { box-sizing:border-box }
  body { margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--ink) }
  header { position:sticky; top:0; backdrop-filter:blur(6px); background:rgba(11,15,20,.8); padding:14px 16px; border-bottom:1px solid #1f2a36 }
  h1 { margin:0; font-size:18px; letter-spacing:.4px }
  .toolbar { display:flex; gap:12px; margin-top:8px; flex-wrap:wrap }
  input[type="search"], select { width:100%; max-width:420px; padding:10px 12px; border-radius:10px; border:1px solid #1f2a36; background:#0e141c; color:#e6edf3 }
  main { padding:16px; display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:14px }
  .card { background:var(--card); border:1px solid #1d2733; border-radius:14px; padding:14px; display:flex; flex-direction:column; gap:8px }
  .title { font-weight:600; line-height:1.3 }
  .meta { display:flex; gap:8px; align-items:center; flex-wrap:wrap; color:var(--muted); font-size:12px }
  .badge { background:var(--chip); border:1px solid #2a3a4f; padding:2px 8px; border-radius:999px; font-size:12px }
  a { color:var(--accent); text-decoration:none }
  a:hover { text-decoration:underline }
  .empty { opacity:.8; font-style:italic }
  footer { padding:24px; color:var(--muted); text-align:center }
</style>
</head>
<body>
<header>
  <h1>Medical News — Webview</h1>
  <div class="toolbar">
    <input id="q" type="search" placeholder="Filter by title, summary, or domain…" />
    <select id="dupFilter" aria-label="Duplicate filter">
      <option value="all">All items</option>
      <option value="deduped">Hide probable duplicates (duplicate_count ≥ 1)</option>
      <option value="dupes">Show only probable duplicates</option>
    </select>
  </div>
</header>

<main id="grid" aria-live="polite"></main>
<footer id="kpi"></footer>

<script>
// === Paste your full JSON payload here (expects { "articles": [...] }) ===
window.FEED = {
  "articles": [
    {"title":"Novel Antibody Neutralizes a Wide Range of HIV Variants","summary":"Human immunodeficiency virus (HIV) ...","hyperlink":"https://www.labroots.com/trending/immunology/29686/novel-antibody-neutralizes-wide-range-hiv-variants","duplicate_count":2},
    {"title":"Three Immunologists Awarded the Nobel Prize in Physiology or Medicine for \"Breakthrough in Peripheral Immune Tolerance\"","summary":"The Nobel Prize in Physiology or Medicine ...","hyperlink":"https://www.labroots.com/trending/immunology/29685/immunologists-awarded-nobel-prize-physiology-medicine-breakthrough-peripheral-immune-tolerance","duplicate_count":2},
    {"title":"New Cannabis Compound Shows Potent Skin Benefits","summary":"How can cannabis compounds be used to improve skin health? ...","hyperlink":"https://www.labroots.com/trending/cannabis-sciences/29687/cannabis-compound-potent-skin-benefits-2","duplicate_count":0}
  ]
};
// =======================================================================

const ITEMS = Array.isArray(window.FEED?.articles) ? window.FEED.articles : [];

function domain(u){ try { return new URL(u).hostname; } catch { return ""; } }

function render(list){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  for(const it of list){
    const t = it.title || '(untitled)';
    const s = it.summary || '';
    const u = it.hyperlink || '';
    const d = domain(u);
    const dup = (typeof it.duplicate_count === 'number') ? it.duplicate_count : 0;

    const card = document.createElement('article');
    card.className = 'card';

    const title = document.createElement('div');
    title.className = 'title';
    title.textContent = t;

    const sum = document.createElement('div');
    sum.className = 'summary';
    sum.textContent = s || '(no summary)';
    if(!s) sum.classList.add('empty');

    const meta = document.createElement('div');
    meta.className = 'meta';
    if(u){
      const link = document.createElement('a');
      link.href = u; link.target = '_blank'; link.rel = 'noopener noreferrer';
      link.textContent = d || 'link';
      meta.appendChild(link);
    }else{
      const span = document.createElement('span');
      span.className = 'empty';
      span.textContent = 'no link';
      meta.appendChild(span);
    }

    const badge = document.createElement('span');
    badge.className = 'badge';
    badge.textContent = `duplicate_count: ${dup}`;
    meta.appendChild(badge);

    card.appendChild(title);
    card.appendChild(sum);
    card.appendChild(meta);
    grid.appendChild(card);
  }
  document.getElementById('kpi').textContent = `${list.length} items shown (of ${ITEMS.length})`;
}

function applyFilters(){
  const q = document.getElementById('q').value.toLowerCase().trim();
  const dupMode = document.getElementById('dupFilter').value;
  let list = ITEMS.slice();

  if(dupMode === 'deduped') list = list.filter(it => (it.duplicate_count || 0) === 0);
  if(dupMode === 'dupes')   list = list.filter(it => (it.duplicate_count || 0) >= 1);

  if(q){
    list = list.filter(it => {
      const hay = [it.title||'', it.summary||'', domain(it.hyperlink||'')].join(' ').toLowerCase();
      return hay.includes(q);
    });
  }
  render(list);
}

document.getElementById('q').addEventListener('input', applyFilters);
document.getElementById('dupFilter').addEventListener('change', applyFilters);
render(ITEMS);
</script>
</body>
</html>